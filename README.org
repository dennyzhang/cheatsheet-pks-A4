* PKS CheatSheet                                                     :Tools:
:PROPERTIES:
:type:     kubernetes, pks, vmware
:export_file_name: cheatsheet-pks-A4.pdf
:END:

#+BEGIN_HTML
<a href="https://github.com/dennyzhang/cheatsheet-pks-A4"><img align="right" width="200" height="183" src="https://www.dennyzhang.com/wp-content/uploads/denny/watermark/github.png" /></a>
<div id="the whole thing" style="overflow: hidden;">
<div style="float: left; padding: 5px"> <a href="https://www.linkedin.com/in/dennyzhang001"><img src="https://www.dennyzhang.com/wp-content/uploads/sns/linkedin.png" alt="linkedin" /></a></div>
<div style="float: left; padding: 5px"><a href="https://github.com/dennyzhang"><img src="https://www.dennyzhang.com/wp-content/uploads/sns/github.png" alt="github" /></a></div>
<div style="float: left; padding: 5px"><a href="https://www.dennyzhang.com/slack" target="_blank" rel="nofollow"><img src="https://slack.dennyzhang.com/badge.svg" alt="slack"/></a></div>
</div>

<br/><br/>
<a href="http://makeapullrequest.com" target="_blank" rel="nofollow"><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg" alt="PRs Welcome"/></a>
#+END_HTML

- PDF Link: [[https://github.com/dennyzhang/cheatsheet-pks-A4/blob/master/cheatsheet-pks-A4.pdf][cheatsheet-pks-A4.pdf]], Category: [[https://cheatsheet.dennyzhang.com/category/tools/][tools]]
- Blog URL: https://cheatsheet.dennyzhang.com/cheatsheet-pks-A4

File me [[https://github.com/DennyZhang/cheatsheet-pks-A4/issues][Issues]] or star [[https://github.com/DennyZhang/cheatsheet-pks-A4][this repo]].

See more CheatSheets from Denny: [[https://github.com/topics/denny-cheatsheets][#denny-cheatsheets]]

Related post: [[https://cheatsheet.dennyzhang.com/cheatsheet-bosh-A4][Bosh CheatSheet]], [[https://cheatsheet.dennyzhang.com/cheatsheet-concourse-A4][Concourse CheatSheet]]
** PKS Basic
| Name                               | Command                                                                                                     |
|------------------------------------+-------------------------------------------------------------------------------------------------------------|
| Reference                          | [[https://docs.pivotal.io/runtimes/pks/1-2/index.html][PKS Documentation]], [[https://docs.pivotal.io/runtimes/pks/1-2/concepts.html][PKS Concepts]], [[https://docs.pivotal.io/runtimes/pks/1-2/release-notes.html][PKS 1.2 Release Notes]], [[https://docs.pivotal.io/runtimes/pks/1-2/managing.html][Managing PKS 1.2]]                                    |
| CFCR/Kubo                          | CFCR(Cloud Foundry Container Runtime) aims to deplo and manage fleets of k8s clusters. Kubo is the old name |
| Bosh                               | [[https://cheatsheet.dennyzhang.com/cheatsheet-bosh-A4][link: BOSH CHEATSHEET]]                                                                                       |
| Tile                               | [[https://cheatsheet.dennyzhang.com/cheatsheet-bosh-A4][link: BOSH CHEATSHEET]]                                                                                       |
| Ops Manager                        | [[https://cheatsheet.dennyzhang.com/cheatsheet-bosh-A4][link: BOSH CHEATSHEET]]                                                                                       |
| osb (on-demand-service-broker)     |                                                                                                             |
| ncp (NSX-T container plugin CNI)   | Help to create pod networks in PKS k8s clusters [[https://cheatsheet.dennyzhang.com/cheatsheet-networking-A4][link: CheatSheet: Cloud Networking]]                          |
| Create k8s cluster                 | [[https://docs.pivotal.io/runtimes/pks/1-2/create-cluster.html][link: Create a Kubernetes Cluster]]                                                                           |
| Air-gapped deployments             | No incoming and outgoing traffic during the PKS deployment                                                  |
** PKS cli
| Name                           | Command                                                                                            |
|--------------------------------+----------------------------------------------------------------------------------------------------|
| List all pks clusters          | =pks clusters=                                                                                     |
| Create cluster                 | =pks create-cluster cluster1 --external-hostname cluster1.pks.com --plan "$plan" --num-nodes 2=    |
| Check cluster status           | =pks cluster cluster1=                                                                             |
| Get cluster kubectl credential | =pks get-credentials <cluster_name>=                                                               |
| Set kubectl context            | =kubectl config use-context <cluster_name>=                                                        |
| List all available plans       | =pks plans=                                                                                        |
| Login                          | =pks login -a <api.test.com> -u <username> -p <passwd> -k= [[https://docs.pivotal.io/runtimes/pks/1-0/manage-users.html][link: Manage Users in UAA]]               |
| Login                          | =pks login --skip-ssl-validation --username <username> --password <password> --api <pks.test.com>= |
| Default roles                  | =pks.clusters.manage=, =pks.clusters.admin=                                                        |
| Run bosh command               | Get bosh crediential from Ops Manager, ssh to opsmanager, and run bosh commands                    |
** Default Process List In PKS Control Panel
| Name                          | Summary                                          |
|-------------------------------+--------------------------------------------------|
| Get process list in pks 1.2.0 | ssh to the pks api vm, then =sudo monit summary= |
| =pks-api=                     |                                                  |
| =broker=                      |                                                  |
| =pks-nsx-t-osb-proxy=         |                                                  |
| =mariadb_ctrl=                |                                                  |
| =galera-healthcheck=          |                                                  |
| =gra-log-purger-executable=   |                                                  |
| =cluster_health_logger=       |                                                  |
| =uaa=                         |                                                  |
| =telemetry=                   |                                                  |
| =event-emitter=               |                                                  |
| =bosh-dns=                    |                                                  |
| =bosh-dns-resolvconf=         |                                                  |
| =bosh-dns-healthcheck=        |                                                  |
** Default Process List In K8S Master VM
| Name                              | Summary                                         |
|-----------------------------------+-------------------------------------------------|
| Get process list in pks 1.2.0     | ssh to k8s master vm, then =sudo monit summary= |
| =kube-apiserver=                  |                                                 |
| =kube-controller-manager=         |                                                 |
| =kube-scheduler=                  |                                                 |
| =etcd=                            |                                                 |
| =blackbox=                        |                                                 |
| =ncp=                             |                                                 |
| =bosh-dns=                        |                                                 |
| =bosh-dns-resolvconf=             |                                                 |
| =bosh-dns-healthcheck=            |                                                 |
| =pks-helpers-bosh-dns-resolvconf= |                                                 |
** Default Process List In K8S Worker VM
| Name                              | Summary                                             |
|-----------------------------------+-----------------------------------------------------|
| Get process list  in pks 1.2.0    | ssh to the k8s worker vm, then =sudo monit summary= |
| =docker=                          |                                                     |
| =kubelet=                         |                                                     |
| =kube-proxy=                      |                                                     |
| =blackbox=                        |                                                     |
| =nsx-node-agent=                  |                                                     |
| =ovsdb-server=                    |                                                     |
| =ovs-vswitchd=                    |                                                     |
| =nsx-kube-proxy=                  |                                                     |
| =bosh-dns=                        |                                                     |
| =bosh-dns-resolvconf=             |                                                     |
| =bosh-dns-healthcheck=            |                                                     |
| =pks-helpers-bosh-dns-resolvconf= |                                                     |
** Online Help Usage
#+BEGIN_EXAMPLE
 [ec2-user@ip-172-31-33-176 ~]$ pks --help

 The Pivotal Container Service (PKS) CLI is used to create, manage, and delete Kubernetes clusters.
 To deploy workloads to a Kubernetes cluster created using the PKS CLI, use the Kubernetes CLI, kubectl.

 Version: 1.1.1-build.8

 Usage:
   pks [command]

 Available Commands:
   cluster         View the details of the cluster
   clusters        Show all clusters created with PKS
   create-cluster  Creates a kubernetes cluster, requires cluster name, an external host name, and plan
   delete-cluster  Deletes a kubernetes cluster, requires cluster name
   get-credentials Allows you to connect to a cluster and use kubectl
   help            Help about any command
   login           Log in to PKS
   logout          Log out of PKS
   plans           View the preconfigured plans available
   resize          Increases the number of worker nodes for a cluster

 Flags:
   -h, --help      help for pks
       --version   version for pks

 Use "pks [command] --help" for more information about a command.
#+END_EXAMPLE
** More Resources
https://github.com/pks-tips/tips

License: Code is licensed under [[https://www.dennyzhang.com/wp-content/mit_license.txt][MIT License]].
#+BEGIN_HTML
<a href="https://www.dennyzhang.com"><img align="right" width="201" height="268" src="https://raw.githubusercontent.com/USDevOps/mywechat-slack-group/master/images/denny_201706.png"></a>
<a href="https://www.dennyzhang.com"><img align="right" src="https://raw.githubusercontent.com/USDevOps/mywechat-slack-group/master/images/dns_small.png"></a>

<a href="https://www.linkedin.com/in/dennyzhang001"><img align="bottom" src="https://www.dennyzhang.com/wp-content/uploads/sns/linkedin.png" alt="linkedin" /></a>
<a href="https://github.com/dennyzhang"><img align="bottom"src="https://www.dennyzhang.com/wp-content/uploads/sns/github.png" alt="github" /></a>
<a href="https://www.dennyzhang.com/slack" target="_blank" rel="nofollow"><img align="bottom" src="https://slack.dennyzhang.com/badge.svg" alt="slack"/></a>
#+END_HTML
* org-mode configuration                                           :noexport:
#+STARTUP: overview customtime noalign logdone showall
#+DESCRIPTION:
#+KEYWORDS:
#+LATEX_HEADER: \usepackage[margin=0.6in]{geometry}
#+LaTeX_CLASS_OPTIONS: [8pt]
#+LATEX_HEADER: \usepackage[english]{babel}
#+LATEX_HEADER: \usepackage{lastpage}
#+LATEX_HEADER: \usepackage{fancyhdr}
#+LATEX_HEADER: \pagestyle{fancy}
#+LATEX_HEADER: \fancyhf{}
#+LATEX_HEADER: \rhead{Updated: \today}
#+LATEX_HEADER: \rfoot{\thepage\ of \pageref{LastPage}}
#+LATEX_HEADER: \lfoot{\href{https://github.com/dennyzhang/cheatsheet-pks-A4}{GitHub: https://github.com/dennyzhang/cheatsheet-pks-A4}}
#+LATEX_HEADER: \lhead{\href{https://cheatsheet.dennyzhang.com/cheatsheet-slack-A4}{Blog URL: https://cheatsheet.dennyzhang.com/cheatsheet-pks-A4}}
#+AUTHOR: Denny Zhang
#+EMAIL:  denny@dennyzhang.com
#+TAGS: noexport(n)
#+PRIORITIES: A D C
#+OPTIONS:   H:3 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:nil skip:nil d:nil todo:t pri:nil tags:not-in-toc
#+EXPORT_EXCLUDE_TAGS: exclude noexport
#+SEQ_TODO: TODO HALF ASSIGN | DONE BYPASS DELEGATE CANCELED DEFERRED
#+LINK_UP:
#+LINK_HOME:
* TODO PKS: How to get pks version for the server side, once I have login to pks vm? :noexport:
* TODO procedure to setup pks                                      :noexport:
create uaac user

pks create cluster

then get the ip to update /etc/hosts
* TODO ssh to k8s vms                                              :noexport:
- delete nat rule
- ssh to ops manager as a bastin
  ssh ubuntu@30.0.0.5
  get bosh credential
  bosh ssh to vm
* TODO uaac token: access token vs refresh token                   :noexport:
* #  --8<-------------------------- separator ------------------------>8-- :noexport:
* TODO manually deploy pks tile: export configuration              :noexport:
* TODO k8s upgrade procedure                                       :noexport:
** How HA model works for the upgrade of multiple-master cluster
** When PKS recreates worker nodes, the upgrade runs on a single VM at a time.
** How fast the upgrade process will finish? 
* TODO add/remove worker vms                                       :noexport:
